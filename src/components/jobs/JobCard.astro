---
import type { JobKitJob } from "../../lib/jobkit";
import { generateSlug, formatRelativeDate, formatSalary } from "../../lib/jobkit";
import JobBadge from "./JobBadge.astro";

interface Props {
  job: JobKitJob;
}

const { job } = Astro.props;
const slug = generateSlug(job);
const isFeatured = job.plan.pin || job.plan.highlight;
const salary = formatSalary(job);
const relativeDate = formatRelativeDate(job.created_at);
---

<article
  class={`group relative overflow-hidden rounded-lg border-2 transition-all hover:shadow-lg ${
    isFeatured
      ? "border-orange-500 bg-orange-50/50 dark:bg-orange-950/20"
      : "border-neutral-200 bg-white dark:border-neutral-800 dark:bg-neutral-900"
  }`}
>
  {isFeatured && (
    <div class="absolute right-0 top-0 rounded-bl-lg bg-orange-500 px-3 py-1 text-xs font-bold text-white">
      Featured
    </div>
  )}

  <a href={`/jobs/${slug}`} class="block p-6">
    <div class="flex items-start gap-4">
      {job.logo && (
        <div class="flex-shrink-0">
          <img
            src={job.logo}
            alt={`${job.company} logo`}
            class="h-12 w-12 rounded-lg object-contain"
          />
        </div>
      )}

      <div class="flex-1 min-w-0">
        <h3 class="text-xl font-bold text-neutral-900 group-hover:text-orange-600 dark:text-white dark:group-hover:text-orange-400 mb-2">
          {job.title}
        </h3>

        <div class="mb-3 text-base text-neutral-600 dark:text-neutral-400">
          <span class="font-semibold">{job.company}</span>
          <span class="mx-2">â€¢</span>
          <span>{job.location}</span>
        </div>

        <div class="flex flex-wrap gap-2 mb-3">
          <JobBadge text={job.term.name} variant="primary" />
          <JobBadge text={job.category.name} variant="secondary" />
          {job.arrangement && (
            <JobBadge
              text={job.arrangement.charAt(0).toUpperCase() + job.arrangement.slice(1)}
              variant="accent"
            />
          )}
        </div>

        <div class="flex items-center justify-between text-sm text-neutral-500 dark:text-neutral-400">
          <span>{relativeDate}</span>
          {salary && <span class="font-semibold text-neutral-700 dark:text-neutral-300">{salary}</span>}
        </div>
      </div>
    </div>
  </a>
</article>
